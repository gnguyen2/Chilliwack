<head>
    <link rel="stylesheet" href = "static/dashboard.css">
</head>

<body>
    <div class="gray-box">
        <div class = "lrg-txt-white">
            <h1>Welcome, {{ user.name }}</h1>
            <p>Email: {{ user.email }}</p>
            <p>Role is "{{ session['user']['role'] }}"</p>
            <p>Status is "{{ session['user']['status'] }}"</p>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message {{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="role_check_box">
            <button type="button" class="color_change_button" id="basic_user_button">Basic User</button>
            <button type="button" class="color_change_button" id="privlaged_user_button">Privlaged User</button>
            <button type="button" class="color_change_button" id="administrator_button">Administrator</button>
        </div>
        <div class = "role_check_box">
            <a href="{{ url_for('auth.logout') }}">Logout</a>
        </div>

        <a href="{{ url_for('admin.admindashboard') }}">Admin Dashboard [FOR TESTING ROLE FUNCTIONALITY **REMOVE ME**]</a>
            
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Get user role and status from Jinja2 context
            const userRole = "{{ user.role.name|safe }}";
            const userStatus = "{{ user.status }}";

            // Your existing code for buttons and role management
            const buttons = document.querySelectorAll(".color_change_button");
    
            const rolePermissions = {
                "basicuser": ["basic_user_button"],
                "privlageduser": ["basic_user_button", "privlaged_user_button"],
                "administrator": ["basic_user_button", "privlaged_user_button", "administrator_button"]
            };

            buttons.forEach(button => {
                button.addEventListener("click", function () {
                    if (!rolePermissions[userRole] || !rolePermissions[userRole].includes(this.id)) {
                        alert("You do not have permission to select this role.");
                        return;
                    }

                    if (this.classList.contains("active")) {
                        this.classList.remove("active");
                    } else {
                        buttons.forEach(btn => btn.classList.remove("active"));
                        this.classList.add("active");
                    }
                });
            });
        });
    </script>
</body>
